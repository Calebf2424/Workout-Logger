{% extends "base.html" %}
{% block title %}Premade Workouts{% endblock %}

{% block content %}
  <h2 class="text-white fw-bold mb-4">Premade Workouts</h2>

  <div class="w-100" style="max-width: 400px;">
    {% if today_routine and today_routine.routine_id %}
      <div class="home-card mb-4 p-3 border border-success border-2">
        <form method="POST" class="d-flex align-items-center justify-content-between">
          <button
              type="submit"
              name="action"
              value="start_{{ today_routine.id }}"
              class="btn btn-link text-success text-decoration-none fw-bold flex-grow-1 text-start"
              style="font-size: 1.4rem;">
                Today's Scheduled: {{ today_routine.name }}
          </button>
          <button type="submit"
                  name="action"
                  value="preview_{{ today_routine.id }}"
                  formaction="{{ url_for('preview_routine', routine_id=today_routine.id) }}"
                  formmethod="get"
                  class="btn btn-sm btn-link text-success p-0"
                  aria-label="Preview">
            <i class="bi bi-eye-fill"></i>
          </button>
        </form>
      </div>
    {% else %}
      <div class="home-card mb-4 p-3 border border-secondary border-2 text-center">
        <p class="mb-0 fw-semibold text-muted" style="font-size: 1.2rem;">
          Today is a Rest Day
        </p>
      </div>
    {% endif %}


    <!-- Routine Cards -->
    {% for r in routines %}
      <div class="home-card mb-3 px-3 py-3">
        <form method="POST" class="d-flex align-items-center justify-content-between">
          <!-- Start the workout (entire left area clickable) -->
            <button
                type="submit"
                name="action"
                value="start_{{ r.id }}"
                class="btn btn-link text-start text-dark text-decoration-none flex-grow-1 ms-2"
                style="font-size: 1.4rem;"
                >
                {{ r.name }}
            </button>

            <div class="d-flex align-items-center">
                <!-- Preview -->
                <button type="submit"
                        name="action"
                        value="preview_{{ r.id }}"
                        formaction="{{ url_for('preview_routine', routine_id=r.id) }}"
                        formmethod="get"
                        class="btn btn-sm btn-link text-dark me-2 p-0"
                        aria-label="Preview">
                  <i class="bi bi-eye-fill"></i>
                </button>
              
                <!-- Edit -->
                <a href="{{ url_for('edit_routine', routine_id=r.id) }}"
                  class="btn btn-sm btn-link text-dark me-2 p-0"
                  aria-label="Edit">
                  <i class="bi bi-pencil-fill"></i>
                </a>
                
                <!-- Delete -->
              {% if not r.is_in_active_program %}
                <button type="submit"
                        name="action"
                        value="delete_{{ r.id }}"
                        class="btn btn-sm btn-link text-danger p-0"
                        aria-label="Delete"
                        onclick="return confirm('Are you sure you want to delete the routine: {{ r.name }}?');">
                  <i class="bi bi-trash-fill"></i>
                </button>
              {% else %}
                <button type="submit"
                        name="action"
                        value="delete_{{ r.id }}"
                        class="btn btn-sm btn-link text-muted p-0"
                        aria-label="Cannot Delete"
                        title="This routine is part of a program and cannot be deleted.">
                  <i class="bi bi-lock-fill"></i>
                </button>
              {% endif %}
              </div>              
        </form>
      </div>
    {% endfor %}

    <!-- Add New Routine Card -->
    <div class="home-card mb-3 px-2 py-1">
      <form method="POST" class="d-flex align-items-center justify-content-center">
        <button
          type="submit"
          name="action"
          value="create"
          class="btn btn-link text-dark fw-semibold text-decoration-none d-flex align-items-center"
          style="font-size: 1.1rem;"
        >
          <i class="bi bi-plus-lg me-2"></i> Add New Routine
        </button>
      </form>
    </div>

    <!-- Home Button -->
    <div class="text-center mt-3">
      <a href="{{ url_for('index') }}" class="btn btn-light">
        <i class="bi bi-house-fill me-1"></i> Home
      </a>
    </div>

  </div>
{% endblock %}
